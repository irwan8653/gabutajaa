<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Generator & Penerjemah Tulisan Gajelas Keren (Konsisten, Tanpa Kunci)
    </title>
    <!-- Tailwind CSS CDN untuk styling yang cepat dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #e0f2fe; /* Latar belakang biru muda */
        transition: background-color 0.3s ease-in-out;
      }
      .container-card {
        background: linear-gradient(
          145deg,
          #ffffff,
          #e0f2fe
        ); /* Gradien latar belakang kartu */
        border-radius: 1.5rem; /* Sudut lebih membulat */
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15),
          0 8px 15px -5px rgba(0, 0, 0, 0.1); /* Bayangan yang lebih dalam */
        animation: fadeIn 0.8s ease-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .button-gradient {
        background-image: linear-gradient(
          to right,
          #4caf50 0%,
          #28a745 51%,
          #4caf50 100%
        ); /* Gradien hijau */
        background-size: 200% auto;
        color: white;
        border-radius: 0.75rem;
        transition: 0.5s;
        box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
      }
      .button-gradient:hover {
        background-position: right center; /* Efek hover gradien */
        transform: translateY(-2px); /* Sedikit naik saat hover */
        box-shadow: 0 6px 15px rgba(40, 167, 69, 0.4);
      }
      .button-gradient.blue {
        background-image: linear-gradient(
          to right,
          #2196f3 0%,
          #0d6efd 51%,
          #2196f3 100%
        ); /* Gradien biru */
        box-shadow: 0 4px 10px rgba(13, 110, 253, 0.3);
      }
      .button-gradient.blue:hover {
        box-shadow: 0 6px 15px rgba(13, 110, 253, 0.4);
      }
      .input-field {
        border-width: 2px;
        border-color: #cbd5e0; /* Border abu-abu terang */
        transition: all 0.3s ease-in-out;
      }
      .input-field:focus {
        outline: none;
        border-color: #3b82f6; /* Border biru saat fokus */
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); /* Ring biru saat fokus */
      }
      .llm-suggestion-box {
        background-color: #ecfdf5; /* Light green background */
        border-left: 5px solid #34d399; /* Green border */
        color: #065f46; /* Dark green text */
      }
      .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-left-color: #3b82f6;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body class="flex flex-col items-center justify-center min-h-screen p-4">
    <div class="container-card w-full max-w-2xl p-8">
      <h1 class="text-4xl font-extrabold text-center text-blue-800 mb-8">
        <span class="block animate-pulse">✨</span> Generator & Penerjemah
        <span class="text-blue-600">Tulisan Gajelas</span>
      </h1>

      <!-- Bagian Input Teks Asli -->
      <div class="mb-6">
        <label
          for="originalText"
          class="block text-gray-700 text-lg font-semibold mb-3"
          >Teks Asli:</label
        >
        <textarea
          id="originalText"
          rows="5"
          class="input-field w-full p-4 rounded-lg resize-y"
          placeholder="Masukkan teks asli Anda di sini..."
        ></textarea>
      </div>

      <!-- Tombol Aksi -->
      <div class="flex flex-col sm:flex-row gap-4 mb-8">
        <button
          id="generateBtn"
          class="button-gradient blue py-3 px-6 text-lg font-bold flex-1"
        >
          Buat Tulisan Gajelas ✨
        </button>
        <button
          id="translateBtn"
          class="button-gradient py-3 px-6 text-lg font-bold flex-1"
        >
          Terjemahkan Kembali
        </button>
      </div>

      <!-- Bagian Hasil -->
      <div>
        <label
          for="resultText"
          class="block text-gray-700 text-lg font-semibold mb-3"
          >Hasil Tulisan Gajelas:</label
        >
        <div class="relative">
          <textarea
            id="resultText"
            rows="5"
            readonly
            class="input-field w-full p-4 rounded-lg bg-gray-50 text-gray-900 resize-y"
          ></textarea>
          <button
            id="copyBtn"
            class="absolute top-3 right-3 bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-3 rounded-md text-sm transition duration-200"
          >
            Salin
          </button>
        </div>
        <div
          id="copyMessage"
          class="text-green-600 text-sm mt-2 hidden text-right"
        >
          Tersalin!
        </div>
      </div>

      <!-- Bagian Saran AI -->
      <div
        id="llmSuggestionContainer"
        class="mt-8 p-4 rounded-lg llm-suggestion-box hidden"
      >
        <p class="text-lg font-semibold mb-2 flex items-center">
          ✨ Ide Konteks AI:
          <span id="llmLoadingIndicator" class="spinner ml-3 hidden"></span>
        </p>
        <p id="llmSuggestionText" class="text-base"></p>
      </div>
    </div>

    <script>
      // Key names for localStorage
      const GARBLED_TEXT_KEY = "garbledText";

      // --- PETA SUBTITUSI TETAP UNTUK KONSISTENSI ---
      // 'a' akan selalu menjadi 'z', 'b' menjadi 'y', dst.
      const ENCRYPTION_MAP = {};
      const DECRYPTION_MAP = {};
      const alphabet = "abcdefghijklmnopqrstuvwxyz";

      for (let i = 0; i < alphabet.length; i++) {
        const originalChar = alphabet[i];
        const encryptedChar = alphabet[alphabet.length - 1 - i];
        ENCRYPTION_MAP[originalChar] = encryptedChar;
        DECRYPTION_MAP[encryptedChar] = originalChar;
      }

      // Fungsi untuk menghasilkan tulisan yang tidak jelas (garbled)
      function generateGarbledText(text) {
        // Tidak lagi menerima keyShift
        let garbledText = "";
        for (let i = 0; i < text.length; i++) {
          let char = text[i];
          let processedChar = char;

          if (char >= "a" && char <= "z") {
            processedChar = ENCRYPTION_MAP[char];
          } else if (char >= "A" && char <= "Z") {
            // Untuk huruf besar, ubah ke kecil, enkripsi, lalu ubah kembali ke besar
            const lowerChar = char.toLowerCase();
            const encryptedLowerChar = ENCRYPTION_MAP[lowerChar];
            processedChar = encryptedLowerChar.toUpperCase();
          }
          // Karakter selain huruf (angka, spasi, simbol) tidak diubah
          garbledText += processedChar;
        }
        return garbledText;
      }

      // Fungsi untuk menerjemahkan tulisan yang tidak jelas kembali ke teks asli
      function translateGarbledText(garbledText) {
        // Tidak lagi menerima keyShift
        let originalText = "";
        for (let i = 0; i < garbledText.length; i++) {
          let char = garbledText[i];
          let processedChar = char;

          if (char >= "a" && char <= "z") {
            processedChar = DECRYPTION_MAP[char];
          } else if (char >= "A" && char <= "Z") {
            // Untuk huruf besar, ubah ke kecil, dekripsi, lalu ubah kembali ke besar
            const lowerChar = char.toLowerCase();
            const decryptedLowerChar = DECRYPTION_MAP[lowerChar];
            processedChar = decryptedLowerChar.toUpperCase();
          }
          // Karakter selain huruf (angka, spasi, simbol) tidak diubah
          originalText += processedChar;
        }
        return originalText;
      }

      // Fungsi untuk memanggil Gemini API dan mendapatkan saran tema
      async function getLLMSuggestion(promptText) {
        llmSuggestionContainer.classList.remove("hidden");
        llmLoadingIndicator.classList.remove("hidden");
        llmSuggestionText.textContent = ""; // Kosongkan teks sebelumnya

        try {
          let chatHistory = [];
          chatHistory.push({
            role: "user",
            parts: [
              {
                text: `Berikan ide tema atau konteks kreatif yang singkat dan menarik (maksimal 15 kata) untuk kalimat berikut: '${promptText}'. Hanya berikan idenya saja, tanpa penjelasan.`,
              },
            ],
          });
          const payload = { contents: chatHistory };
          const apiKey = ""; // Canvas akan menyediakan API key secara otomatis
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

          const response = await fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const result = await response.json();
          if (
            result.candidates &&
            result.candidates.length > 0 &&
            result.candidates[0].content &&
            result.candidates[0].content.parts &&
            result.candidates[0].content.parts.length > 0
          ) {
            const text = result.candidates[0].content.parts[0].text;
            llmSuggestionText.textContent = text;
          } else {
            llmSuggestionText.textContent =
              "Tidak dapat menghasilkan saran tema saat ini.";
            console.error("Gemini API response structure unexpected:", result);
          }
        } catch (error) {
          llmSuggestionText.textContent =
            "Terjadi kesalahan saat memanggil AI.";
          console.error("Error calling Gemini API:", error);
        } finally {
          llmLoadingIndicator.classList.add("hidden");
        }
      }

      // Dapatkan elemen-elemen dari DOM
      const originalTextInput = document.getElementById("originalText");
      const generateBtn = document.getElementById("generateBtn");
      const translateBtn = document.getElementById("translateBtn");
      const resultTextInput = document.getElementById("resultText");
      const copyBtn = document.getElementById("copyBtn");
      const copyMessage = document.getElementById("copyMessage");
      const llmSuggestionContainer = document.getElementById(
        "llmSuggestionContainer"
      );
      const llmSuggestionText = document.getElementById("llmSuggestionText");
      const llmLoadingIndicator = document.getElementById(
        "llmLoadingIndicator"
      );

      // Event listener untuk tombol 'Buat Tulisan Gajelas'
      generateBtn.addEventListener("click", async () => {
        const originalText = originalTextInput.value;
        if (!originalText.trim()) {
          originalTextInput.value =
            "Masukkan teks yang ingin diubah terlebih dahulu!";
          return;
        }

        // Kunci pergeseran tidak lagi diperlukan, langsung panggil fungsi enkripsi
        const garbled = generateGarbledText(originalText);
        resultTextInput.value = garbled;

        // Simpan teks gajelas ke localStorage
        localStorage.setItem(GARBLED_TEXT_KEY, garbled);

        // Sembunyikan pesan salin
        copyMessage.classList.add("hidden");

        // Panggil fungsi AI untuk saran tema
        await getLLMSuggestion(originalText);
      });

      // Event listener untuk tombol 'Terjemahkan Kembali'
      translateBtn.addEventListener("click", () => {
        // Ambil teks gajelas dari input hasil
        let garbledTextToTranslate = resultTextInput.value;

        // Jika belum ada teks gajelas di input hasil, coba ambil dari localStorage
        if (!garbledTextToTranslate && localStorage.getItem(GARBLED_TEXT_KEY)) {
          garbledTextToTranslate = localStorage.getItem(GARBLED_TEXT_KEY);
          resultTextInput.value = garbledTextToTranslate; // Tampilkan juga di input hasil
        }

        if (!garbledTextToTranslate) {
          const errorMessage =
            "Belum ada tulisan gajelas yang tersimpan. Harap buat tulisan gajelas terlebih dahulu.";
          originalTextInput.value = errorMessage;
          return;
        }

        // Panggil fungsi dekripsi
        const translated = translateGarbledText(garbledTextToTranslate);
        originalTextInput.value = translated; // Tampilkan hasil terjemahan di kolom teks asli

        // Sembunyikan saran AI setelah diterjemahkan
        llmSuggestionContainer.classList.add("hidden");
        copyMessage.classList.add("hidden"); // Sembunyikan pesan salin
      });

      // Event listener untuk tombol 'Salin'
      copyBtn.addEventListener("click", () => {
        resultTextInput.select(); // Pilih semua teks di area hasil
        document.execCommand("copy"); // Salin teks ke clipboard
        copyMessage.classList.remove("hidden"); // Tampilkan pesan tersalin
        setTimeout(() => {
          copyMessage.classList.add("hidden"); // Sembunyikan pesan setelah beberapa detik
        }, 2000);
      });

      // Muat data dari localStorage saat halaman dimuat
      document.addEventListener("DOMContentLoaded", () => {
        const savedGarbledText = localStorage.getItem(GARBLED_TEXT_KEY);

        if (savedGarbledText) {
          resultTextInput.value = savedGarbledText;
        } else {
          // Atur contoh teks asli jika belum ada data yang tersimpan
          originalTextInput.value =
            "Ini adalah pesan rahasia yang ingin saya acak!";
        }
      });
    </script>
  </body>
</html>
